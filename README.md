# Person Account Aggregator (Spring Boot 3.4)

–≠—Ç–æ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ **Spring WebFlux**. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–±–∏—Ä–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∏—Ç–æ–º—Ü–µ –∏ —Å—Ç–∞—Ç—É—Å–µ –∑–∞–∫–∞–∑–∞ –∏–∑ –¥–≤—É—Ö –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Person Service –∏ Account Service), –∏—Å–ø–æ–ª—å–∑—É—è –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π **WebClient**.

---

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* **Reactive Stack**: –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –±–∞–∑–µ Project Reactor.
* **API-First Design**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è DTO –∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π OpenAPI 3.0.
* **Resilience4j Integration**:
    * **Retry**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–≤—ã—Ö —Å–±–æ—è—Ö.
    * **Circuit Breaker**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –ø–∞–¥–µ–Ω–∏–π –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º.
    * **Fallback**: –í–æ–∑–≤—Ä–∞—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤–º–µ—Å—Ç–æ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫.
* **Observability**: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ Spring Boot Actuator –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ Swagger UI.

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—ã–∑—ã–≤–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∫—Ä–∞—â–∞–µ—Ç –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º.



1.  **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Mono.zip` –¥–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ–ø—Ä–æ—Å–∞ Person –∏ Account API.
2.  **–ò–∑–æ–ª—è—Ü–∏—è**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ —Ä–∞–∑–Ω—ã–µ Java-–ø–∞–∫–µ—Ç—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –º–æ–¥–µ–ª–µ–π.

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

* **Java 17**
* **Spring Boot 3.4.1** (WebFlux, AOP, Actuator)
* **Maven** (openapi-generator-maven-plugin)
* **Resilience4j** (Circuit Breaker & Retry)
* **WireMock** (–¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –æ—Ç–∫–∞–∑–æ–≤)

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

* `src/main/resources/api/` ‚Äî —Ñ–∞–π–ª—ã —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π:
    * `person_api.yaml` (–í–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å)
    * `account_api.yaml` (–í–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å)
    * `internal_api.yaml` (–ù–∞—à API)
* `src/main/java/com/example/personaccount/config/` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ WebClient –∏ ApiClient.
* `src/main/java/com/example/personaccount/service/` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.
* `src/test/java/com/example/personaccount/` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏ WireMock.

---


## üõ† –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

–í —Ä–∞–º–∫–∞—Ö –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç –±—ã–ª –ø–µ—Ä–µ–≤–µ–¥–µ–Ω –Ω–∞ —Å—Ç–µ–∫ **Spring Boot 3.4.1 (Spring Framework 6.2)**. –û—Å–Ω–æ–≤–Ω–æ–π —É–ø–æ—Ä —Å–¥–µ–ª–∞–Ω –Ω–∞ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—é –æ—Ç–≤–µ—Ç–æ–≤.

### 1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (RFC 7807)
–í–Ω–µ–¥—Ä–µ–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π `GlobalExceptionHandler`, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π –æ–±—ä–µ–∫—Ç `ProblemDetail`. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–µ.

* **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ `@PathVariable` –∏ `@RequestParam` (–∫–∞–∫ —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π `HandlerMethodValidationException`, —Ç–∞–∫ –∏ —á–µ—Ä–µ–∑ `ConstraintViolationException`).
* **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:** –ò—Å–∫–ª—é—á–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è —Å–µ—Ä–≤–∏—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `EntityNotFoundException`) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞–ø—è—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å `404 Not Found` —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—É—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞ –≤ –ø–æ–ª–µ `instance`.



### 2. –†–µ–∞–∫—Ç–∏–≤–Ω–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å (Resilience)
–°–µ—Ä–≤–∏—Å –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω —Å —É—á–µ—Ç–æ–º –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–∏—Ö API (Person –∏ Account):

* **Retry Mechanism:** –ü—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö —Å–±–æ—è—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞—Ö `5xx` –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤, —Å–∏—Å—Ç–µ–º–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–æ **3 –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫** —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π.
* **Smart Fallback:** –í —Å–ª—É—á–∞–µ –ø–æ–ª–Ω–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º (–ø–æ—Å–ª–µ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—è –ø–æ–ø—ã—Ç–æ–∫), –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è ("Unknown"), –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —á–∞—Å—Ç–∏—á–Ω—É—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å (Graceful Degradation).
* **Selective Error Handling:** –û—à–∏–±–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ `4xx` (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω") –Ω–µ –ø–æ–¥–≤–µ—Ä–≥–∞—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –ø–æ–ø—ã—Ç–∫–∞–º –∏ —Å—Ä–∞–∑—É –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –∫–ª–∏–µ–Ω—Ç—É, —á—Ç–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É.

### 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

| –£—Ä–æ–≤–µ–Ω—å | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π |
| :--- | :--- | :--- |
| **Unit** | `WebTestClient` + `Mockito` | –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ `GlobalExceptionHandler` –∏ –º–∞–ø–ø–∏–Ω–≥–∞ —Å—Ç–∞—Ç—É—Å-–∫–æ–¥–æ–≤. |
| **Integration** | `WireMock` + `DynamicPropertySource` | –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∑–∞–ø—Ä–æ—Å–∞ –∫ –≤–Ω–µ—à–Ω–∏–º API, —Ä–∞–±–æ—Ç–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞. |



#### –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (400 Bad Request):
–ü—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ ID (`personId = 0`), —Å–∏—Å—Ç–µ–º–∞ –≤–µ—Ä–Ω–µ—Ç:
```json
{
  "type": "about:blank",
  "title": "Validation Failed",
  "status": 400,
  "detail": "personId: –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω—å—à–µ 1",
  "instance": "/aggregate/0/1",
  "timestamp": 1736428595000
}